# ~/.bashrc_squeezebox
# =======================================================================
#  bash shell configuration - squeezebox and lyrion music server controls
# =======================================================================


LMS_URL="http://10.0.0.100:9000"
SQUEEZEBOX_MAC="00:04:20:23:82:6f"


# send request to Squeezebox player API on local nextwork
send-squeezebox-cmd () {
    local command="$1"
    local payload='
        {
            "id":1,
            "method":"slim.request",
            "params":[
                "'"${SQUEEZEBOX_MAC}"'",
                '"${command}"'
            ]
        }'
    lms_result=$(curl -4 --fail --silent --request POST \
        --max-time 2.0 --data "${payload}" "${LMS_URL}/jsonrpc.js")
    if [ -z "${lms_result}" ]; then
        err "can't reach LMS or Squeezebox"
    fi
}


# show currently playing track on Squeezebox player
squeezebox-show () {
    send-squeezebox-cmd '["status", "-", "1", "tags:a"]'
    if [ -n "${lms_result}" ]; then
        jq -r '.result.playlist_loop | .[0] | "\(.artist) - \(.title)"' \
            <<< "${lms_result}"
    fi
}
alias s=squeezebox-show


# skip to next track in playlist on Squeezebox player
squeezebox-next () {
    send-squeezebox-cmd '["button","jump_fwd"]'
    squeezebox-show
}
alias n=squeezebox-next


# play random song mix on Squeezebox player
squeezebox-mix () {
    send-squeezebox-cmd '["randomplay","tracks"]'
    squeezebox-show
}
alias m="squeezebox-mix"


# pause/resume audio on Squeezebox player
squeezebox-pause () {
    send-squeezebox-cmd '["pause"]'
}
alias p="squeezebox-pause"
